## Solved Problems

### When is a trade successful?
A trade is considered successful when the [Exchange]TradingProvider reports it as such. 

### Who checks the exchange trading provider?
The TradingProvider will be checked by the AllocationService, who using real world data, has a
final say over the state of the portfolio.

### How does the allocation provider learn about a trade?
The TradingProvider will inform its WeakAllocation about a trade that was reported
as successful by its implementation.

### What happens when the local and remote portfolio diverge?
The remote portfolio is considered more truthful, but a warning is produced. When the divergence is too
large, or the new TotalPortfolio contains negative allocations, the system is halted and users are informed.

### How does the allocation provider handle updates? (and differentiate between algorithms)
* The WeakAllocation provider will inform the actual AllocationService about a change that
the trading provider reported. The AllocationService will use this trade to create a diverging branch
of the TotalPortfolio state. New trades will be halted until the following process has finished entirely.

* Subsequently, it will fetch the actual portfolio (using the eponymous service), to generate a second branched
state. Here it is assumed that any diffs are generated by the last algorithm that reported a trade and will thus delegate
the diff to that specific AlgorithmPorfolio section.

* For the final stage, the newly fetched remote portfolio will be checked against the original known state. If no diff
is occured, the application will produce a warning, but continue with the remote portfolio as truth.

* Lastly, if the previous step did produce a diff, the two branches (remote, and supposedly after trade) will be
checked againt each other. The ideal is that these version are on and the same. Yet, when they are not, another
warning is produces and the remote portfolio considered the truth. Again, if the differences exceed a threshold, the system
is halted and users are informed.

### How does the allocation manager interpret the remote portfolio back to a, per algorithm, splitted list?
TradingProviders are kept in a busy wait (when requesting trade verification) until no other trades are pending. This ensures
to remote state to diff by a maximum of one trade. It can now be assumed that any diff occurs in the allocation
of the Algorithm that reported the trade in the first place.


## Pseudo code as should be found in the TradingProvider
```csharp
public void PlaceFullMarketOrder(pair, algo)
{
    AlgorithmPortfolio pre = weakAllocation.GetPortfolio();
    decimal amount = pre.GetAllocation(pair);
    Trade proposal = new Trade(pair, amount);
    // Kept in busy wait if other trade is still review
    if (weakAllocation.VerifyTrade(proposal))
    {
        _implementation.MarketOrder(proposal.Pair, proposal.Amount)
    }
    weakAllocation.ReportTrade(proposal)
    AlgorithmPorfolio post = weakAllocation.GetPortfolio();
    DatabaseTrade log = new DatabaseTrade(proposal, pre, post);
    _databaseContext.Write(log);
}
```
    
    
